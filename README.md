# 股票实时监控工具

## 项目概述

本项目是一个功能完整的股票实时监控工具，支持获取A股和港股的实时数据，并提供K线图绘制和显示功能。程序采用双数据源设计（新浪财经和东方财富网），确保数据获取的可靠性。

## 设计考虑
### 功能需求
 - 实时获取股票数据
 -- 实时价格，成交量
 -- 开盘价，收盘价，最高价，最低价
 -- 实时指标获取（macd、kdj、cci、expma）
 -- 数据包括秒级数据，1分钟交易数据
 -- 获取时间间隔配置（1s-1分钟） 
 -- 多市场支持（A股（上证、深证）、港股）

 - 获取历史股票数据
 -- 实时价格，成交量
 -- 开盘价，收盘价，最高价，最低价
 -- 实时指标获取（macd、kdj、cci、expma）
 -- 数据包括：日、周、月、年 60 分钟、30 分钟、15 分钟、5 分钟、1 分钟
 -- 多市场支持（A股（上证、深证）、港股）
 -- 支持配置获取的时间范围（1天-1年）

 - 数据持久化存储
   -- 存储数据库为SQLite
   -- 支持多个股票交易级别的数据存储，包括：日、周、月、年、60分钟、30分钟、15分钟、5分钟、1分钟
   -- 存储格式：
         当股票数据为：日 ，周 ，月 ，年  sqlite表名为：股票代码_日/周/月/年
         当股票数据为：60 分钟，30 分钟，15 分钟，5 分钟，1 分钟 sqlite表名为：股票代码_月份_60m/30m/15m/5m/1m

 - 数据可视化展示（K线图）
   -- K线图显示
   -- 成交量显示
   -- 实时指标输出（macd、kdj、cci、expma）
   -- 实时买卖点输出（金叉死叉，顶背离，底背离，超买，超卖）

- 交易策略
   -- 指标计算 macd,kdj,cci,expma,获取买卖点
   -- 指标状态获取：顶背离，底背离，金叉死叉，超买，超卖

- 实时交易
   -- 实盘交易
      --半自动/自动交易
      --交易股票数量控制
      --风控机制（防止超买超卖）
   -- 模拟盘交易
      --半自动/自动交易
      --交易股票数量控制
      --风控机制（防止超买超卖）

- 回测
   -- 回测指标有效性
   -- 回测结果可视化展示（K线图）
  
-选股
  -- 选股策略配置

#### 非功能需求
 - 性能
   -- 需要考虑多股票数据同时监控，确保实时性，cpu占用率考虑

 - 容量
   -- 存储历史数据，确保数据库容量足够
   -- 内存占用率考虑

 - 可扩展性
   -- 支持添加新的股票市场（如美股）
   -- 支持添加新的股票数据指标
   -- 支持添加新的交易策略
   -- 支持添加新的数据可视化方式
   -- 支持添加新的交易策略可视化方式（如买卖点）

 - 安全性

 - 可靠性
   -- 双备份股票数据源确保可靠性
 - 易用性
   -- 用户友好界面
   -- 命令行友好

## 核心功能

- **实时数据监控**：获取股票实时价格、开盘价、最高价、最低价、成交量等信息
- **多市场支持**：支持A股（上证、深证）和港股
- **数据可视化**：绘制K线图并支持实时更新
- **数据持久化**：自动将股票数据保存到SQLite数据库
- **多时间范围**：支持日、周、月、年等不同时间周期的K线图
- **双数据源**：新浪财经和东方财富网双备份，确保数据可靠性

## 主要文件

1. **real_time_stock.py** - 主程序文件，包含完整的实时监控功能
2. **stock_chart.py** - 股票图表绘制相关功能
3. **stock_data.db** - SQLite数据库，用于存储股票历史数据
4. **test_hk_stock.py** - 港股数据获取测试脚本
5. **test_hk_stock_fix.py** - 修复验证测试脚本

## 快速开始

### 安装依赖

```bash
pip install requests pandas numpy matplotlib sqlite3
```

### 运行监控程序

#### 监控A股（示例：平安银行 000001）

```bash
python real_time_stock.py --symbol 000001 --interval 5 --time-range day --with-gui
```

#### 监控港股（示例：小鹏汽车-W 09868）

```bash
python real_time_stock.py --symbol 09868 --interval 5 --time-range day --with-gui
```

### 命令行参数

```
-h, --help            显示帮助信息
--symbol SYMBOL       股票代码（必填）
--interval INTERVAL   数据更新间隔（秒），默认5秒
--time-range {day,week,month,year} 时间范围，默认day
--save-to-db          仅将数据保存到数据库，不进行实时监控
--load-from-db        从数据库加载数据并显示
--with-gui            启用GUI显示（K线图）
--no-gui              禁用GUI显示（仅终端显示）
```

## 示例输出

```
============================================================
实时股票监控 - 小鹏汽车-W(09868)
============================================================
当前价格: 70.80 元
涨跌额: -9797.20 元
涨跌幅: -99.28%
开盘价: 70.60 元
最高价: 71.25 元
最低价: 70.10 元
成交量: 3 股
成交金额: 72.3 元
更新时间: 2025-12-18 11:16:06
今日1分钟K线数: 100
============================================================
按 Ctrl+C 停止监控...
```

## 技术实现

### 数据获取

程序采用双数据源设计，确保数据获取的可靠性：

1. **新浪财经接口**：作为主要数据源
2. **东方财富网接口**：作为备选数据源，当新浪财经接口获取失败时自动切换

### 数据处理

- 使用`requests`库发送HTTP请求获取数据
- 对返回数据进行解析和格式转换
- 确保所有数值字段为正确的类型（float/int）

### 数据可视化

- 使用`matplotlib`绘制K线图
- 支持实时数据更新到图表
- 保存K线图为PNG文件

### 数据存储

- 使用SQLite数据库存储股票历史数据
- 支持按时间范围查询和加载数据

## 支持的股票类型

### A股

- **上证股票**：代码以6开头（如600000）
- **深证股票**：代码以00或30开头（如000001、300001）

### 港股

- 香港市场股票（如0700、09868）

## 故障排除

### 问题1：获取不到股票数据

**解决方案：**
1. 检查股票代码是否正确
2. 确保网络连接正常
3. 程序会自动切换到备选数据源，等待几秒后再次尝试

### 问题2：K线图无法显示

**解决方案：**
1. 确保已安装matplotlib库
2. 检查是否使用了`--with-gui`参数启用GUI显示
3. 检查系统是否支持图形界面

### 问题3：成交量显示异常

**解决方案：**
- 这可能是由于数据源返回的成交量单位不同导致的
- 程序已经进行了单位转换处理，如仍有问题请检查数据源配置

## 项目结构

```
stock_analysis/
├── real_time_stock.py      # 主程序文件
├── stock_chart.py          # 图表绘制功能
├── stock_data.db           # SQLite数据库
├── test_hk_stock.py        # 港股测试脚本
├── test_hk_stock_fix.py    # 修复验证测试
└── README.md               # 项目说明文档
```

## 注意事项

1. **数据延迟**：实时数据可能存在一定延迟，具体取决于数据源
2. **网络依赖**：程序需要稳定的网络连接才能获取数据
3. **API限制**：数据源可能有访问频率限制，建议合理设置更新间隔
4. **港股支持**：港股数据获取经过特殊优化，支持5位和6位代码

## 未来改进

- 增加更多数据源支持
- 提供更多技术指标计算
- 支持自定义K线图样式
- 增加预警功能

## 许可证

本项目采用MIT许可证，可自由使用和修改。