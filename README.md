# 股票实时监控工具

## 项目概述

本项目是一个功能完整的股票实时监控工具，支持获取A股和港股的实时数据，并提供K线图绘制和显示功能。程序采用双数据源设计（新浪财经和东方财富网），确保数据获取的可靠性。

## 核心功能

- **实时数据监控**：获取股票实时价格、开盘价、最高价、最低价、成交量等信息
- **多市场支持**：支持A股（上证、深证）和港股
- **数据可视化**：绘制K线图并支持实时更新
- **数据持久化**：自动将股票数据保存到SQLite数据库
- **多时间范围**：支持日、周、月、年等不同时间周期的K线图
- **双数据源**：新浪财经和东方财富网双备份，确保数据可靠性

## 主要文件

1. **real_time_stock.py** - 主程序文件，包含完整的实时监控功能
2. **stock_chart.py** - 股票图表绘制相关功能
3. **stock_data.db** - SQLite数据库，用于存储股票历史数据
4. **test_hk_stock.py** - 港股数据获取测试脚本
5. **test_hk_stock_fix.py** - 修复验证测试脚本

## 快速开始

### 安装依赖

```bash
pip install requests pandas numpy matplotlib sqlite3
```

### 运行监控程序

#### 监控A股（示例：平安银行 000001）

```bash
python real_time_stock.py --symbol 000001 --interval 5 --time-range day --with-gui
```

#### 监控港股（示例：小鹏汽车-W 09868）

```bash
python real_time_stock.py --symbol 09868 --interval 5 --time-range day --with-gui
```

### 命令行参数

```
-h, --help            显示帮助信息
--symbol SYMBOL       股票代码（必填）
--interval INTERVAL   数据更新间隔（秒），默认5秒
--time-range {day,week,month,year} 时间范围，默认day
--save-to-db          仅将数据保存到数据库，不进行实时监控
--load-from-db        从数据库加载数据并显示
--with-gui            启用GUI显示（K线图）
--no-gui              禁用GUI显示（仅终端显示）
```

## 示例输出

```
============================================================
实时股票监控 - 小鹏汽车-W(09868)
============================================================
当前价格: 70.80 元
涨跌额: -9797.20 元
涨跌幅: -99.28%
开盘价: 70.60 元
最高价: 71.25 元
最低价: 70.10 元
成交量: 3 股
成交金额: 72.3 元
更新时间: 2025-12-18 11:16:06
今日1分钟K线数: 100
============================================================
按 Ctrl+C 停止监控...
```

## 技术实现

### 数据获取

程序采用双数据源设计，确保数据获取的可靠性：

1. **新浪财经接口**：作为主要数据源
2. **东方财富网接口**：作为备选数据源，当新浪财经接口获取失败时自动切换

### 数据处理

- 使用`requests`库发送HTTP请求获取数据
- 对返回数据进行解析和格式转换
- 确保所有数值字段为正确的类型（float/int）

### 数据可视化

- 使用`matplotlib`绘制K线图
- 支持实时数据更新到图表
- 保存K线图为PNG文件

### 数据存储

- 使用SQLite数据库存储股票历史数据
- 支持按时间范围查询和加载数据

## 支持的股票类型

### A股

- **上证股票**：代码以6开头（如600000）
- **深证股票**：代码以00或30开头（如000001、300001）

### 港股

- 香港市场股票（如0700、09868）

## 故障排除

### 问题1：获取不到股票数据

**解决方案：**
1. 检查股票代码是否正确
2. 确保网络连接正常
3. 程序会自动切换到备选数据源，等待几秒后再次尝试

### 问题2：K线图无法显示

**解决方案：**
1. 确保已安装matplotlib库
2. 检查是否使用了`--with-gui`参数启用GUI显示
3. 检查系统是否支持图形界面

### 问题3：成交量显示异常

**解决方案：**
- 这可能是由于数据源返回的成交量单位不同导致的
- 程序已经进行了单位转换处理，如仍有问题请检查数据源配置

## 项目结构

```
stock_analysis/
├── real_time_stock.py      # 主程序文件
├── stock_chart.py          # 图表绘制功能
├── stock_data.db           # SQLite数据库
├── test_hk_stock.py        # 港股测试脚本
├── test_hk_stock_fix.py    # 修复验证测试
└── README.md               # 项目说明文档
```

## 注意事项

1. **数据延迟**：实时数据可能存在一定延迟，具体取决于数据源
2. **网络依赖**：程序需要稳定的网络连接才能获取数据
3. **API限制**：数据源可能有访问频率限制，建议合理设置更新间隔
4. **港股支持**：港股数据获取经过特殊优化，支持5位和6位代码

## 未来改进

- 增加更多数据源支持
- 提供更多技术指标计算
- 支持自定义K线图样式
- 增加预警功能

## 许可证

本项目采用MIT许可证，可自由使用和修改。